generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model audit_logs {
  id        String   @id
  userId    String?
  action    String
  details   String?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  users     users?   @relation(fields: [userId], references: [id])
}

model kyc_documents {
  id              String    @id
  userId          String
  documentType    String
  documentCountry String    @default("TR")
  fileUrl         String
  ocrData         String?
  livenessScore   Float?
  status          String    @default("PENDING")
  uploadedAt      DateTime  @default(now())
  reviewedAt      DateTime?
  reviewedBy      String?
  users           users     @relation(fields: [userId], references: [id])
}

model ledger_entries {
  id          String   @id
  userId      String
  type        String
  amount      Float
  currency    String   @default("TRY")
  description String?
  referenceId String?
  status      String   @default("PENDING")
  metadata    String?
  createdAt   DateTime @default(now())
  users       users    @relation(fields: [userId], references: [id])
}

model orders {
  id        String    @id
  userId    String
  symbol    String
  type      String
  side      String
  quantity  Float
  price     Float?
  stopPrice Float?
  status    String    @default("PENDING")
  metadata  String?
  filledAt  DateTime?
  createdAt DateTime  @default(now())
  users     users     @relation(fields: [userId], references: [id])
}

model positions {
  id           String    @id
  userId       String
  symbol       String
  side         String
  quantity     Float
  entryPrice   Float
  currentPrice Float
  pnl          Float     @default(0)
  margin       Float
  leverage     Float     @default(1)
  isOpen       Boolean   @default(true)
  openedAt     DateTime  @default(now())
  closedAt     DateTime?
  avgPrice     Float     @default(0)
  users        users     @relation(fields: [userId], references: [id])
}

model price_overrides {
  id            String   @id
  symbol        String   @unique
  overridePrice Float
  spread        Float?
  slippage      Float?
  isActive      Boolean  @default(true)
  createdBy     String
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  users         users    @relation(fields: [createdBy], references: [id])
}

model security_logs {
  id        String   @id
  userId    String
  event     String
  ip        String?
  device    String?
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id])
}

model users {
  id                     String            @id
  email                  String            @unique
  passwordHash           String
  firstName              String?
  lastName               String?
  accountLevel           String            @default("STARTER")
  accountType            String            @default("REAL")
  kycTier                Int               @default(0)
  riskScore              Float             @default(0.0)
  isAdmin                Boolean           @default(false)
  isCorporate            Boolean           @default(false)
  addressVerified        Boolean           @default(false)
  twoFASecret            String?
  isTwoFAEnabled         Boolean           @default(false)
  isEmailVerified        Boolean           @default(false)
  emailVerificationToken String?
  resetPasswordToken     String?
  kycStatus              String            @default("NOT_SUBMITTED")
  createdAt              DateTime          @default(now())
  updatedAt              DateTime
  audit_logs             audit_logs[]
  kyc_documents          kyc_documents[]
  ledger_entries         ledger_entries[]
  orders                 orders[]
  positions              positions[]
  price_overrides        price_overrides[]
  security_logs          security_logs[]
  wallets                wallets[]
  watchlists             watchlists[]
  alarms                 alarms[]
}

model wallets {
  id         String   @id
  userId     String
  currency   String
  balance    Float    @default(0)
  frozen     Float    @default(0)
  updatedAt  DateTime
  balance_t1 Float    @default(0)
  balance_t2 Float    @default(0)
  users      users    @relation(fields: [userId], references: [id])

  @@unique([userId, currency])
}

model watchlists {
  id        String   @id
  userId    String
  symbol    String
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id])

  @@unique([userId, symbol])
}

model alarms {
  id          String   @id @default(uuid())
  userId      String
  symbol      String
  targetPrice Float
  condition   String   // 'ABOVE' or 'BELOW'
  isActive    Boolean  @default(true)
  isTriggered Boolean  @default(false)
  createdAt   DateTime @default(now())
  users       users    @relation(fields: [userId], references: [id])
}
